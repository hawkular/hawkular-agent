#
# Copyright 2015-2017 Red Hat, Inc. and/or its affiliates
# and other contributors as indicated by the @author tags.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

---
subsystem:
  enabled: "${hawkular.agent.enabled:true}"
  immutable: "${hawkular.agent.immutable:false}"
  in-container: "${hawkular.agent.in-container:false}"
  auto-discovery-scan-period-secs: ${hawkular.agent.auto-discovery-scan-period-secs:600}

metrics-exporter:
  enabled: true
  host: ${hawkular.agent.metrics.host:127.0.0.1}
  port: ${hawkular.agent.metrics.port:9779}
  config-dir: ${jboss.server.config.dir}
  config-file: wildfly-10

diagnostics:
  enabled:    true
  interval:   1
  time-units: minutes

storage-adapter:
  feed-id:   itest-rest-feed
  url:       http://127.0.0.1:8080
  username:  itest-rest
  password:  itest-rest-password

# DMR

metric-set-dmr:
- name: WildFly Memory Metrics
  metric-dmr:
  - name: Heap Used
    metric-units: bytes
    metric-type:  gauge
    path:         /core-service=platform-mbean/type=memory
    attribute:    heap-memory-usage#used
    metric-family: jvm_memory_bytes_used
    metric-labels:
      area: heap
  - name: Heap Committed
    metric-units: bytes
    metric-type:  gauge
    path:         /core-service=platform-mbean/type=memory
    attribute:    heap-memory-usage#committed
    metric-family: jvm_memory_bytes_committed
    metric-labels:
      area: heap
  - name: Heap Max
    metric-units: bytes
    metric-type:  gauge
    path:         /core-service=platform-mbean/type=memory
    attribute:    heap-memory-usage#max
    metric-family: jvm_memory_bytes_max
    metric-labels:
      area: heap
  - name: NonHeap Used
    metric-units: bytes
    path:         /core-service=platform-mbean/type=memory
    attribute:    non-heap-memory-usage#used
    metric-family: jvm_memory_bytes_used
    metric-labels:
      area: nonheap
  - name: NonHeap Committed
    metric-units: bytes
    path:         /core-service=platform-mbean/type=memory
    attribute:    non-heap-memory-usage#committed
    metric-family: jvm_memory_bytes_committed
    metric-labels:
      area: nonheap
  - name: NonHeap Max
    metric-units: bytes
    path:         /core-service=platform-mbean/type=memory
    attribute:    non-heap-memory-usage#max
    metric-family: jvm_memory_bytes_max
    metric-labels:
      area: nonheap
  - name: Accumulated GC Duration
    metric-units: seconds
    metric-type:  counter
    path:         "/core-service=platform-mbean/type=garbage-collector/name=*"
    attribute:    collection-time
    metric-family: jvm_gc_collection_seconds_sum
    # no metric-labels because we want to aggregate across all of them
- name: WildFly Threading Metrics
  metric-dmr:
  - name: Thread Count
    metric-type:  gauge
    path:         /core-service=platform-mbean/type=threading
    attribute:    thread-count
    metric-family: jvm_threads_current
- name: WildFly Aggregated Web Metrics
  metric-dmr:
  - name: Aggregated Active Web Sessions
    path:       "/deployment=*/subsystem=undertow"
    attribute:  active-sessions
    metric-family: wildfly_deployment_active_sessions
  - name: Aggregated Max Active Web Sessions
    path:       "/deployment=*/subsystem=undertow"
    attribute:  max-active-sessions
    metric-family: wildfly_deployment_max_active_sessions
  - name: Aggregated Expired Web Sessions
    path:       "/deployment=*/subsystem=undertow"
    attribute:  expired-sessions
    metric-family: wildfly_deployment_expired_sessions
  - name: Aggregated Rejected Web Sessions
    path:       "/deployment=*/subsystem=undertow"
    attribute:  rejected-sessions
    metric-family: wildfly_deployment_rejected_sessions
  - name: Aggregated Servlet Request Time
    path:       "/deployment=*/subsystem=undertow/servlet=*"
    attribute:  total-request-time
    metric-family: wildfly_servlet_total_request_time
  - name: Aggregated Servlet Request Count
    path:       "/deployment=*/subsystem=undertow/servlet=*"
    attribute:  request-count
    metric-family: wildfly_servlet_request_count
- name: Undertow Metrics
  metric-dmr:
  - name: Active Sessions
    path:       "/subsystem=undertow"
    attribute:  active-sessions
    metric-family: wildfly_deployment_active_sessions
  - name: Sessions Created
    path:       "/subsystem=undertow"
    attribute:  sessions-created
    metric-type: counter
    metric-family: wildfly_deployment_sessions_created
  - name: Expired Sessions
    path:       "/subsystem=undertow"
    attribute:  expired-sessions
    metric-type: counter
    metric-family: wildfly_deployment_expired_sessions
  - name: Rejected Sessions
    path:       "/subsystem=undertow"
    attribute:  rejected-sessions
    metric-type: counter
    metric-family: wildfly_deployment_rejected_sessions
  - name: Max Active Sessions
    path:       "/subsystem=undertow"
    attribute:  max-active-sessions
    metric-family: wildfly_deployment_max_active_sessions
- name: Servlet Metrics
  metric-dmr:
  - name: Max Request Time
    attribute:    max-request-time
    metric-units: milliseconds
    metric-family: wildfly_servlet_max_request_time
  - name: Min Request Time
    attribute:    min-request-time
    metric-units: milliseconds
    metric-family: wildfly_servlet_min_request_time
  - name: Total Request Time
    attribute:    total-request-time
    metric-units: milliseconds
    metric-family: wildfly_servlet_total_request_time
  - name: Request Count
    attribute:    request-count
    metric-type:  counter
    metric-family: wildfly_servlet_request_count
- name: Singleton EJB Metrics
  metric-dmr:
  - name: Execution Time
    attribute:    execution-time
    metric-family: wildfly_ejb_execution_time
    metric-labels:
      type: singleton
  - name: Invocations
    attribute:    invocations
    metric-type:  counter
    metric-family: wildfly_ejb_invocations
    metric-labels:
      type: singleton
  - name: Peak Concurrent Invocations
    attribute:    peak-concurrent-invocations
    metric-family: wildfly_ejb_peak_concurrent_invocations
    metric-labels:
      type: singleton
  - name: Wait Time
    attribute:    wait-time
    metric-family: wildfly_ejb_wait_time
    metric-labels:
      type: singleton
- name: Message Driven EJB Metrics
  metric-dmr:
  - name: Execution Time
    attribute:    execution-time
    metric-family: wildfly_ejb_execution_time
    metric-labels:
      type: message-driven
  - name: Invocations
    attribute:    invocations
    metric-type:  counter
    metric-family: wildfly_ejb_invocations
    metric-labels:
      type: message-driven
  - name: Peak Concurrent Invocations
    attribute:    peak-concurrent-invocations
    metric-family: wildfly_ejb_peak_concurrent_invocations
    metric-labels:
      type: message-driven
  - name: Wait Time
    attribute:    wait-time
    metric-family: wildfly_ejb_wait_time
    metric-labels:
      type: message-driven
  - name: Pool Available Count
    attribute:    pool-available-count
    metric-family: wildfly_ejb_pool_available_count
    metric-labels:
      type: message-driven
  - name: Pool Create Count
    attribute:    pool-create-count
    metric-family: wildfly_ejb_pool_create_count
    metric-labels:
      type: message-driven
  - name: Pool Current Size
    attribute:    pool-current-size
    metric-family: wildfly_ejb_pool_current_size
    metric-labels:
      type: message-driven
  - name: Pool Max Size
    attribute:    pool-max-size
    metric-family: wildfly_ejb_pool_max_size
    metric-labels:
      type: message-driven
  - name: Pool Remove Count
    attribute:    pool-remove-count
    metric-family: wildfly_ejb_pool_remove_count
    metric-labels:
      type: message-driven
- name: Stateless Session EJB Metrics
  metric-dmr:
  - name: Execution Time
    attribute:    execution-time
    metric-family: wildfly_ejb_execution_time
    metric-labels:
      type: stateless-session
  - name: Invocations
    attribute:    invocations
    metric-type:  counter
    metric-family: wildfly_ejb_invocations
    metric-labels:
      type: stateless-session
  - name: Peak Concurrent Invocations
    attribute:    peak-concurrent-invocations
    metric-family: wildfly_ejb_peak_concurrent_invocations
    metric-labels:
      type: stateless-session
  - name: Wait Time
    attribute:    wait-time
    metric-family: wildfly_ejb_wait_time
    metric-labels:
      type: stateless-session
  - name: Pool Available Count
    attribute:    pool-available-count
    metric-family: wildfly_ejb_pool_available_count
    metric-labels:
      type: stateless-session
  - name: Pool Create Count
    attribute:    pool-create-count
    metric-family: wildfly_ejb_pool_create_count
    metric-labels:
      type: stateless-session
  - name: Pool Current Size
    attribute:    pool-current-size
    metric-family: wildfly_ejb_pool_current_size
    metric-labels:
      type: stateless-session
  - name: Pool Max Size
    attribute:    pool-max-size
    metric-family: wildfly_ejb_pool_max_size
    metric-labels:
      type: stateless-session
  - name: Pool Remove Count
    attribute:    pool-remove-count
    metric-family: wildfly_ejb_pool_remove_count
    metric-labels:
      type: stateless-session
- name: Stateful Session EJB Metrics
  metric-dmr:
  - name: Execution Time
    attribute:    execution-time
    metric-family: wildfly_ejb_execution_time
    metric-labels:
      type: stateful-session
  - name: Invocations
    attribute:    invocations
    metric-type:  counter
    metric-family: wildfly_ejb_invocations
    metric-labels:
      type: stateful-session
  - name: Peak Concurrent Invocations
    attribute:    peak-concurrent-invocations
    metric-family: wildfly_ejb_peak_concurrent_invocations
    metric-labels:
      type: stateful-session
  - name: Wait Time
    attribute:    wait-time
    metric-family: wildfly_ejb_wait_time
    metric-labels:
      type: stateful-session
  - name: Cache Size
    attribute:    cache-size
    metric-family: TODO
    metric-labels:
      type: stateful-session
  - name: Total Size
    attribute:    total-size
    metric-family: TODO
    metric-labels:
      type: stateful-session
- name: Datasource JDBC Metrics
  metric-dmr:
  - name: Prepared Statement Cache Access Count
    path:         "/statistics=jdbc"
    attribute:    PreparedStatementCacheAccessCount
    metric-family: wildfly_datasource_jdbc_prepared_statement_cache_access_count
  - name: Prepared Statement Cache Add Count
    path:         "/statistics=jdbc"
    attribute:    PreparedStatementCacheAddCount
    metric-family: wildfly_datasource_jdbc_prepared_statement_cache_add_count
  - name: Prepared Statement Cache Current Size
    path:         "/statistics=jdbc"
    attribute:    PreparedStatementCacheCurrentSize
    metric-family: wildfly_datasource_jdbc_prepared_statement_cache_current_size
  - name: Prepared Statement Cache Delete Count
    path:         "/statistics=jdbc"
    attribute:    PreparedStatementCacheDeleteCount
    metric-family: wildfly_datasource_jdbc_prepared_statement_cache_delete_count
  - name: Prepared Statement Cache Hit Count
    path:         "/statistics=jdbc"
    attribute:    PreparedStatementCacheHitCount
    metric-family: wildfly_datasource_jdbc_prepared_statement_cache_hit_count
  - name: Prepared Statement Cache Miss Count
    path:         "/statistics=jdbc"
    attribute:    PreparedStatementCacheMissCount
    metric-family: wildfly_datasource_jdbc_prepared_statement_cache_miss_count
- name: Datasource Pool Metrics
  metric-dmr:
  - name: Active Count
    path:         "/statistics=pool"
    attribute:    ActiveCount
    metric-family: wildfly_datasorce_pool_active_count
  - name: Available Count
    path:         "/statistics=pool"
    attribute:    AvailableCount
    metric-family: wildfly_datasorce_pool_available_count
  - name: Average Blocking Time
    path:         "/statistics=pool"
    attribute:    AverageBlockingTime
    metric-family: wildfly_datasorce_pool_average_blocking_time
  - name: Average Creation Time
    path:         "/statistics=pool"
    attribute:    AverageCreationTime
    metric-family: wildfly_datasorce_pool_average_creation_time
  - name: Average Get Time
    path:         "/statistics=pool"
    attribute:    AverageGetTime
    metric-family: wildfly_datasorce_pool_average_get_time
  - name: Blocking Failure Count
    path:         "/statistics=pool"
    attribute:    BlockingFailureCount
    metric-family: wildfly_datasorce_pool_blocking_failure_count
  - name: Created Count
    path:         "/statistics=pool"
    attribute:    CreatedCount
    metric-family: wildfly_datasorce_pool_created_count
  - name: Destroyed Count
    path:         "/statistics=pool"
    attribute:    DestroyedCount
    metric-family: wildfly_datasorce_pool_destroyed_count
  - name: Idle Count
    path:         "/statistics=pool"
    attribute:    IdleCount
    metric-family: wildfly_datasorce_pool_idle_count
  - name: In Use Count
    path:         "/statistics=pool"
    attribute:    InUseCount
    metric-family: wildfly_datasorce_pool_in_use_count
  - name: Max Creation Time
    path:         "/statistics=pool"
    attribute:    MaxCreationTime
    metric-family: wildfly_datasorce_pool_max_creation_time
  - name: Max Get Time
    path:         "/statistics=pool"
    attribute:    MaxGetTime
    metric-family: wildfly_datasorce_pool_max_get_time
  - name: Max Used Count
    path:         "/statistics=pool"
    attribute:    MaxUsedCount
    metric-family: wildfly_datasorce_pool_max_used_count
  - name: Max Wait Count
    path:         "/statistics=pool"
    attribute:    MaxWaitCount
    metric-family: wildfly_datasorce_pool_max_wait_count
  - name: Max Wait Time
    path:         "/statistics=pool"
    attribute:    MaxWaitTime
    metric-family: wildfly_datasorce_pool_max_wait_time
  - name: Timed Out
    path:         "/statistics=pool"
    attribute:    TimedOut
    metric-family: wildfly_datasorce_pool_timed_out
  - name: Total Blocking Time
    path:         "/statistics=pool"
    attribute:    TotalBlockingTime
    metric-family: wildfly_datasorce_pool_total_blocking_time
  - name: Total Creation Time
    path:         "/statistics=pool"
    attribute:    TotalCreationTime
    metric-family: wildfly_datasorce_pool_total_creation_time
  - name: Total Get Time
    path:         "/statistics=pool"
    attribute:    TotalGetTime
    metric-family: wildfly_datasorce_pool_total_get_time
  - name: Wait Count
    path:         "/statistics=pool"
    attribute:    WaitCount
    metric-family: wildfly_datasorce_pool_wait_count
- name: Transactions Metrics
  metric-dmr:
  - name: Number of Aborted Transactions
    attribute:    number-of-aborted-transactions
    metric-type:  counter
    metric-family: wildfly_transactions_aborted_transactions
  - name: Number of Application Rollbacks
    attribute:    number-of-application-rollbacks
    metric-type:  counter
    metric-family: wildfly_transactions_application_rollbacks
  - name: Number of Committed Transactions
    attribute:    number-of-committed-transactions
    metric-type:  counter
    metric-family: wildfly_transactions_committed_transactions
  - name: Number of Heuristics
    attribute:    number-of-heuristics
    metric-type:  counter
    metric-family: wildfly_transactions_heuristics
  - name: Number of In-Flight Transactions
    attribute:    number-of-inflight-transactions
    metric-family: wildfly_transactions_inflight_transactions
  - name: Number of Nested Transactions
    attribute:    number-of-nested-transactions
    metric-type:  counter
    metric-family: wildfly_transactions_nested_transactions
  - name: Number of Resource Rollbacks
    attribute:    number-of-resource-rollbacks
    metric-type:  counter
    metric-family: wildfly_transactions_resource_rollbacks
  - name: Number of Timed Out Transactions
    attribute:    number-of-timed-out-transactions
    metric-type:  counter
    metric-family: wildfly_transactions_timed_out_transactions
  - name: Number of Transactions
    attribute:    number-of-transactions
    metric-type:  counter
    metric-family: wildfly_transactions_transactions
- name: JMS Queue Metrics
  metric-dmr:
  - name: Consumer Count
    attribute:    consumer-count
    metric-family: wildfly_messaging_consumer_count
  - name: Delivering Count
    attribute:    delivering-count
    metric-family: wildfly_messaging_delivering_count
  - name: Message Count
    attribute:    message-count
    metric-family: wildfly_messaging_message_count
  - name: Messages Added
    attribute:    messages-added
    metric-type:  counter
    metric-family: wildfly_messaging_messages_added
  - name: Scheduled Count
    attribute:    scheduled-count
    metric-family: wildfly_messaging_scheduled_count
- name: JMS Topic Metrics
  metric-dmr:
  - name: Durable Message Count
    attribute:    durable-message-count
    metric-family: wildfly_messaging_durable_message_count
  - name: Durable Subscription Count
    attribute:    durable-subscription-count
    metric-family: wildfly_messaging_durable_subscription_count
  - name: Delivering Count
    attribute:    delivering-count
    metric-family: wildfly_messaging_delivering_count
  - name: Message Count
    attribute:    message-count
    metric-family: wildfly_messaging_message_count
  - name: Messages Added
    attribute:    messages-added
    metric-type:  counter
    metric-family: wildfly_messaging_messages_added
  - name: Non-Durable Message Count
    attribute:    non-durable-message-count
    metric-family: wildfly_messaging_non_durable_message_count
  - name: Non-Durable Subscription Count
    attribute:    non-durable-subscription-count
    metric-family: wildfly_messaging_non_durable_subscription_count
  - name: Subscription Count
    attribute:    subscription-count
    metric-family: wildfly_messaging_subscription_count

resource-type-set-dmr:
- name: Standalone Environment
  resource-type-dmr:
  - name: WildFly Server
    resource-name-template: "%ManagedServerName"
    notification-dmr:
    - name: resource-added
    metric-sets:
    - WildFly Memory Metrics
    - WildFly Threading Metrics
    - WildFly Aggregated Web Metrics
    resource-config-dmr:
    - name: Name
      attribute: name
    - name: Product Name
      attribute: product-name
    - name: Version
      attribute: product-version
    - name: Running Mode
      attribute: running-mode
    - name: Server State
      attribute: server-state
    - name: Suspend State
      attribute: suspend-state
    - name: UUID
      attribute: uuid
    - name: Home Directory
      attribute: home-dir
      path:      /core-service=server-environment
    - name: Node Name
      attribute: node-name
      path:      /core-service=server-environment
    - name: Hostname
      attribute: qualified-host-name
      path:      /core-service=server-environment
    - name: Bound Address
      attribute: bound-address
      path:     /socket-binding-group=standard-sockets/socket-binding=http
    operation-dmr:
    - name: JDR
      internal-name: generate-jdr-report
      path:          /subsystem=jdr
    - name: Reload
      internal-name: reload
      modifies:      true
      params:
      - name: admin-only
        type:          bool
        default-value: "false"
        description:   Whether the server should start in running mode ADMIN_ONLY when it restarts
      - name: use-current-server-config
        type:          bool
        default-value: "false"
    - name: Resume
      internal-name: resume
      modifies:      true
    - name: Shutdown
      internal-name: shutdown
      modifies:      true
      params:
      - name: timeout
        type:          int
        default-value: "0"
        description:   Timeout in seconds to allow active connections to drain
      - name: restart
        type:          bool
        default-value: "false"
        description:   "Should the server be restarted after shutdown?"
    - name: Suspend
      internal-name: suspend
      modifies:      true
      params:
      - name: timeout
        type:          int
        default-value: "0"
        description:   Timeout in seconds to allow active connections to drain
    - name: Deploy
      internal-name: deploy
      modifies:      true
    - name: Undeploy
      internal-name: undeploy
      modifies:      true
    - name: Enable Deployment
      internal-name: enable-deployment
      modifies:      true
    - name: Disable Deployment
      internal-name: disable-deployment
      modifies:      true
    - name: Restart Deployment
      internal-name: restart-deployment
      modifies:      true

- name: Domain Environment
  resource-type-dmr:
  - name: Host Controller
    resource-name-template: "%ManagedServerName"
    notification-dmr:
    - name: resource-added
    resource-config-dmr:
    - name: Product Name
      attribute: product-name
    - name: Version
      attribute: product-version
    - name: Process Type
      attribute: process-type
    - name: Local Host Name
      attribute: local-host-name
    operation-dmr:
    - name: Reload Servers
      internal-name: reload-servers
      modifies:      true
      params:
      - name: blocking
        type:          bool
        description:   Wait until the servers are stopped before returning from the operation.
    - name: Restart Servers
      internal-name: restart-servers
      modifies:      true
      params:
      - name: blocking
        type:          bool
        description:   Wait until the servers are stopped before returning from the operation.
    - name: Resume Servers
      internal-name: resume-servers
      modifies:      true
    - name: Start Servers
      internal-name: start-servers
      modifies:      true
      params:
      - name: blocking
        type:          bool
        description:   Wait until the servers are stopped before returning from the operation.
    - name: Stop Servers
      internal-name: stop-servers
      modifies:      true
      params:
      - name: blocking
        type:          bool
        description:   Wait until the servers are stopped before returning from the operation.
      - name: timeout
        type:          int
        default-value: "0"
        description:   Timeout in seconds to allow active connections to drain
    - name: Suspend Servers
      internal-name: suspend-servers
      modifies:      true
      params:
      - name: timeout
        type:          int
        default-value: "0"
        description:   Timeout in seconds to allow active connections to drain
    - name: Deploy
      internal-name: deploy
      modifies:      true
    - name: Undeploy
      internal-name: undeploy
      modifies:      true
    - name: Enable Deployment
      internal-name: enable-deployment
      modifies:      true
    - name: Disable Deployment
      internal-name: disable-deployment
      modifies:      true
    - name: Restart Deployment
      internal-name: restart-deployment
      modifies:      true

  - name: Domain Profile
    resource-name-template: "%-"
    path: "/profile=*"
    parents:
    - Host Controller
    resource-config-dmr:
    - name: Name
      attribute: name

  - name: Domain Server Group
    resource-name-template: "%-"
    path: "/server-group=*"
    parents:
    - Host Controller
    resource-config-dmr:
    - name: Profile
      attribute: profile
    operation-dmr:
    - name: Reload Servers
      internal-name: reload-servers
      modifies:      true
      params:
      - name: blocking
        type:          bool
        default-value: false
        description:   Wait until the servers are stopped before returning from the operation.
    - name: Restart Servers
      internal-name: restart-servers
      modifies:      true
      params:
      - name: blocking
        type:          bool
        default-value: false
        description:   Wait until the servers are stopped before returning from the operation.
    - name: Resume Servers
      internal-name: resume-servers
      modifies:      true
    - name: Start Servers
      internal-name: start-servers
      modifies:      true
      params:
      - name: blocking
        type:          bool
        default-value: false
        description:   Wait until the servers are stopped before returning from the operation.
    - name: Stop Servers
      internal-name: stop-servers
      modifies:      true
      params:
      - name: blocking
        type:          bool
        default-value: false
        description:   Wait until the servers are stopped before returning from the operation.
      - name: timeout
        type:          int
        description:   Timeout in seconds to allow active connections to drain
    - name: Suspend Servers
      internal-name: suspend-servers
      modifies:      true
      params:
      - name: timeout
        type:          int
        description:   Timeout in seconds to allow active connections to drain

  - name: Domain Host
    resource-name-template: "%-"
    path: "/host=*"
    parents:
    - Host Controller
    notification-dmr:
    - name: resource-added
    metric-sets:
    - WildFly Memory Metrics
    - WildFly Threading Metrics
    resource-config-dmr:
    - name: Name
      attribute: name
    - name: Product Name
      attribute: product-name
    - name: Version
      attribute: product-version
    - name: Is Domain Controller
      attribute: master
    - name: Host State
      attribute: host-state
    - name: Running Mode
      attribute: running-mode
    - name: Server State
      attribute: server-state
    - name: Suspend State
      attribute: suspend-state
    - name: UUID
      attribute: uuid
    - name: Home Directory
      attribute: home-dir
      path:      /core-service=server-environment
    operation-dmr:
    - name: Reload
      internal-name: reload
      modifies:      true
    - name: Shutdown
      internal-name: shutdown
      modifies:      true
      params:
      - name: restart
        type:        bool
        description: If true, once shutdown the host controller will be restarted again.

  - name: Domain WildFly Server
    resource-name-template: "%-"
    path: "/server=*"
    parents:
    - Domain Host
    notification-dmr:
    - name: resource-added
    metric-sets:
    - WildFly Memory Metrics
    - WildFly Threading Metrics
    - WildFly Aggregated Web Metrics
    resource-config-dmr:
    - name: Name
      attribute: name
    - name: Host
      attribute: host
    - name: Product Name
      attribute: product-name
    - name: Version
      attribute: product-version
    - name: Profile Name
      attribute: profile-name
    - name: Server Group
      attribute: server-group
    - name: Running Mode
      attribute: running-mode
    - name: Server State
      attribute: server-state
    - name: Suspend State
      attribute: suspend-state
    - name: UUID
      attribute: uuid
    - name: Hostname
      attribute: qualified-host-name
      path:      /core-service=server-environment
    - name: Node Name
      attribute: node-name
      path:      /core-service=server-environment
    - name: Initial Running Mode
      attribute: initial-running-mode
      path:      /core-service=server-environment
    - name: Base Directory
      attribute: base-dir
      path:      /core-service=server-environment
    - name: Bound Address
      attribute: bound-address
      path:     /socket-binding-group=full-sockets/socket-binding=http
    operation-dmr:
    - name: JDR
      internal-name: generate-jdr-report
      path:          /subsystem=jdr

  - name: Domain WildFly Server Controller
    resource-name-template: "%-"
    path: "/server-config=*"
    parents:
    - Domain Host
    notification-dmr:
    - name: resource-added
    resource-config-dmr:
    - name: Name
      attribute: name
    - name: Server Group
      attribute: group
    - name: Auto Start
      attribute: auto-start
    - name: Status
      attribute: status
    operation-dmr:
    - name: Destroy
      internal-name: destroy
      modifies:      true
    - name: Kill
      internal-name: kill
      modifies:      true
    - name: Reload
      internal-name: reload
      modifies:      true
      params:
      - name: server
        description: The name of the server.
      - name: blocking
        type:          bool
        default-value: "false"
        description:   Wait until the servers are stopped before returning from the operation.
    - name: Restart
      internal-name: restart
      modifies:      true
      params:
      - name: server
        description: The name of the server.
      - name: blocking
        type:          bool
        default-value: "false"
        description:   Wait until the servers are stopped before returning from the operation.
    - name: Resume
      internal-name: resume
      modifies:      true
    - name: Start
      internal-name: start
      modifies:      true
      params:
      - name: server
        description: The name of the server.
      - name: blocking
        type:          bool
        default-value: "false"
        description:   Wait until the servers are stopped before returning from the operation.
    - name: Stop
      internal-name: stop
      modifies:      true
      params:
      - name: server
        description: The name of the server.
      - name: blocking
        type:          bool
        default-value: "false"
        description:   Wait until the servers are stopped before returning from the operation.
      - name: timeout
        type:          int
        description:   Timeout in seconds to allow active connections to drain
    - name: Suspend
      internal-name: suspend
      modifies:      true
      params:
      - name: timeout
        type:          int
        description:   Timeout in seconds to allow active connections to drain

- name: Deployment
  resource-type-dmr:
  - name: Deployment
    resource-name-template: "%-"
    path: "/deployment=*"
    parents:
    - WildFly Server
    - Domain WildFly Server
    metric-sets:
    - Undertow Metrics
    metric-labels:
      deployment: "%-"
  - name: SubDeployment
    resource-name-template: "%-"
    path: "/subdeployment=*"
    parents:
    - Deployment
    metric-sets:
    - Undertow Metrics
    metric-labels:
      subdeployment: "%-"

- name: Web Component
  resource-type-dmr:
  - name: Servlet
    resource-name-template: "%-"
    path: "/subsystem=undertow/servlet=*"
    parents:
    - Deployment
    - SubDeployment
    metric-sets:
    - Servlet Metrics
    metric-labels:
      name: "%-"

- name: EJB
  resource-type-dmr:
  - name: Singleton EJB
    resource-name-template: "%-"
    path: "/subsystem=ejb3/singleton-bean=*"
    parents:
    - Deployment
    - SubDeployment
    metric-sets:
    - Singleton EJB Metrics
    metric-labels:
      name: "%-"
  - name: Message Driven EJB
    resource-name-template: "%-"
    path: "/subsystem=ejb3/message-driven-bean=*"
    parents:
    - Deployment
    - SubDeployment
    metric-sets:
    - Message Driven EJB Metrics
    metric-labels:
      name: "%-"
  - name: Stateless Session EJB
    resource-name-template: "%-"
    path: "/subsystem=ejb3/stateless-session-bean=*"
    parents:
    - Deployment
    - SubDeployment
    metric-sets:
    - Stateless Session EJB Metrics
    metric-labels:
      name: "%-"
  - name: Stateful Session EJB
    resource-name-template: "%-"
    path: "/subsystem=ejb3/stateful-session-bean=*"
    parents:
    - Deployment
    - SubDeployment
    metric-sets:
    - Stateful Session EJB Metrics
    metric-labels:
      name: "%-"

- name: Datasource
  resource-type-dmr:
  - name: Datasource
    resource-name-template: "%-"
    path: "/subsystem=datasources/data-source=*"
    parents:
    - WildFly Server
    - Domain WildFly Server
    metric-sets:
    - Datasource Pool Metrics
    - Datasource JDBC Metrics
    metric-labels:
      name: "%-"
    resource-config-dmr:
    - name: Connection URL
      attribute: connection-url
      resolve-expressions: true
    - name: Driver Name
      attribute: driver-name
    - name: Driver Class
      attribute: driver-class
    - name: Datasource Class
      attribute: datasource-class
    - name: Enabled
      attribute: enabled
    - name: JNDI Name
      attribute: jndi-name
    - name: Username
      attribute: user-name
    - name: Password
      attribute: password
    - name: Security Domain
      attribute: security-domain
    - name: Connection Properties
      path:      "/connection-properties=*"
      attribute: value

- name: XA Datasource
  resource-type-dmr:
  - name: XA Datasource
    resource-name-template: "%-"
    path: "/subsystem=datasources/xa-data-source=*"
    parents:
    - WildFly Server
    - Domain WildFly Server
    metric-sets:
    - Datasource Pool Metrics
    - Datasource JDBC Metrics
    metric-labels:
      name: "%-"
    resource-config-dmr:
    - name: Driver Name
      attribute: driver-name
    - name: XA Datasource Class
      attribute: xa-datasource-class
    - name: Enabled
      attribute: enabled
    - name: JNDI Name
      attribute: jndi-name
    - name: Username
      attribute: user-name
    - name: Password
      attribute: password
    - name: Security Domain
      attribute: security-domain
    - name: Datasource Properties
      path:      "/xa-datasource-properties=*"
      attribute: value

- name: JDBC Driver
  resource-type-dmr:
  - name: JDBC Driver
    resource-name-template: "%-"
    path: "/subsystem=datasources/jdbc-driver=*"
    parents:
    - WildFly Server
    - Domain WildFly Server
    resource-config-dmr:
    - name: Driver Class
      attribute: driver-class-name
    - name: Module Name
      attribute: driver-module-name
    - name: Driver Name
      attribute: driver-name
    - name: XA DS Class
      attribute: driver-xa-datasource-class-name

- name: Transaction Manager
  resource-type-dmr:
  - name: Transaction Manager
    resource-name-template: Transaction Manager
    path: "/subsystem=transactions"
    parents:
    - WildFly Server
    - Domain WildFly Server
    metric-sets:
    - Transactions Metrics

- name: Messaging
  resource-type-dmr:
  - name: Messaging Server
    resource-name-template: "%-"
    path: "/subsystem=messaging-activemq/server=*"
    parents:
    - WildFly Server
    - Domain WildFly Server
  - name: JMS Queue
    resource-name-template: "%-"
    path: "/jms-queue=*"
    parents:
    - Messaging Server
    metric-sets:
    - JMS Queue Metrics
    metric-labels:
      name: "%-"
  - name: JMS Topic
    resource-name-template: "%-"
    path: "/jms-topic=*"
    parents:
    - Messaging Server
    metric-sets:
    - JMS Topic Metrics
    metric-labels:
      name: "%-"

- name: Socket Binding Group
  resource-type-dmr:
  - name: Socket Binding Group
    resource-name-template: "%-"
    path: "/socket-binding-group=*"
    parents:
    - WildFly Server
    - Host Controller
    resource-config-dmr:
    - name: Name
      attribute: name
    - name: Port Offset
      attribute: port-offset
      resolve-expressions: true
    - name: Default Interface
      attribute: default-interface
  - name: Socket Binding
    resource-name-template: "%-"
    path: "/socket-binding=*"
    parents:
    - Socket Binding Group
    resource-config-dmr:
    - name: Name
      attribute: name
    - name: Interface
      attribute: interface
    - name: Port
      attribute: port
      resolve-expressions: true
    - name: Multicast Address
      attribute: multicast-address
      resolve-expressions: true
    - name: Multicast Port
      attribute: multicast-port
  - name: Remote Destination Outbound Socket Binding
    resource-name-template: "%-"
    path: "/remote-destination-outbound-socket-binding=*"
    parents:
    - Socket Binding Group
    resource-config-dmr:
    - name: Host
      attribute: host
    - name: Port
      attribute: port

- name: Clustering
  resource-type-dmr:
  - name: ModCluster
    resource-name-template: "ModCluster"
    path:                   "/subsystem=modcluster"
    parents:
    - WildFly Server
    - Domain WildFly Server
    resource-config-dmr:
    - name: Connector
      attribute: connector
      path:      "/mod-cluster-config=configuration"
    - name: Advertise Socket Binding
      attribute: advertise-socket
      path:      "/mod-cluster-config=configuration"
  - name: JGroups
    resource-name-template: "JGroups"
    path:                   "/subsystem=jgroups"
    parents:
    - WildFly Server
    - Domain WildFly Server
  - name: JGroups Channel
    resource-name-template: "%-"
    path:                   "/channel=*"
    parents:
    - JGroups
    resource-config-dmr:
    - name: Cluster Name
      attribute: cluster
    - name: IP Address
      attribute: address
    - name: Group Membership View
      attribute: view

  - name: Infinispan
    resource-name-template: "Infinispan"
    path:                   "/subsystem=infinispan"
    parents:
    - WildFly Server
    - Domain WildFly Server
  - name: Infinispan Cache Container
    resource-name-template: "%-"
    path:                   "/cache-container=*"
    parents:
    - Infinispan
    resource-config-dmr:
    - name: Cluster Name
      attribute: cluster-name
    - name: Coordinator Address
      attribute: coordinator-address
    - name: Is Coordinator
      attribute: is-coordinator

# JMX

metric-set-jmx:
- name: Runtime Metrics
  metric-jmx:
  - name: VM Uptime
    attribute:    Uptime
    metric-units: milliseconds
    metric-type:  counter
    metric-family: TODO
  - name: Used Heap Memory
    object-name:  java.lang:type=Memory
    attribute:    HeapMemoryUsage#used
    metric-units: bytes
    metric-type:  gauge
    metric-family: jvm_memory_bytes_used
    metric-labels:
      area: heap
  - name: Aggregate GC Collection Time
    object-name:  "java.lang:type=GarbageCollector,name=*"
    attribute:    CollectionTime
    metric-units: seconds
    metric-family: jvm_gc_collection_seconds_sum
- name: Memory Pool Metrics
  metric-jmx:
  - name: Initial
    attribute:    Usage#init
    metric-units: bytes
    metric-type:  gauge
    metric-family: TODO
  - name: Used
    attribute:    Usage#used
    metric-units: bytes
    metric-type:  gauge
    metric-family: jvm_memory_pool_bytes_used
  - name: Committed
    attribute:    Usage#committed
    metric-units: bytes
    metric-type:  gauge
    metric-family: jvm_memory_pool_bytes_committed
  - name: Max
    attribute:    Usage#max
    metric-units: bytes
    metric-type:  gauge
    metric-family: jvm_memory_pool_bytes_max

resource-type-set-jmx:
- name: Main
  resource-type-jmx:
  - name: Runtime MBean
    resource-name-template: JMX [%_ManagedServerName%][%type%]
    object-name: java.lang:type=Runtime
    metric-sets:
    - Runtime Metrics
    resource-config-jmx:
    - name: OS Name
      attribute:   Name
      object-name: java.lang:type=OperatingSystem
    - name: Java VM Name
      attribute:   VmName
- name: Memory Pool
  resource-type-jmx:
  - name: Memory Pool MBean
    parents:
    - Runtime MBean
    resource-name-template: JMX [%_ManagedServerName%] %type% %name%
    object-name: "java.lang:type=MemoryPool,name=*"
    metric-sets:
    - Memory Pool Metrics
    resource-config-jmx:
    - name: Type
      attribute: Type
- name: Hawkular
  resource-type-jmx:
  - name: Hawkular Java Agent
    resource-name-template: "Hawkular Java Agent"
    object-name: "org.hawkular:type=hawkular-javaagent"
    resource-config-jmx:
    - name: Immutable
      attribute: Immutable
    - name: In Container
      attribute: InContainer
    operation-jmx:
    - name: Start
      internal-name: start
    - name: Stop
      internal-name: stop
    - name: Status
      internal-name: status
    - name: Inventory Discovery Scan
      internal-name: fullDiscoveryScan
    - name: Inventory Report
      internal-name: inventoryReport
- name: For Integration Test
  resource-type-jmx:
  - name: Simple ITest MBean
    resource-name-template: "Simple ITest MBean"
    object-name: org.hawkular.agent.itest:type=simple
    resource-config-jmx:
    - name: Immutable
      attribute: Immutable
    - name: TestString
      attribute: TestString
    - name: TestIntegerPrimitive
      attribute: TestIntegerPrimitive
    - name: TestInteger
      attribute: TestInteger
    - name: TestBooleanPrimitive
      attribute: TestBooleanPrimitive
    - name: TestBoolean
      attribute: TestBoolean
    - name: TestLongPrimitive
      attribute: TestLongPrimitive
    - name: TestLong
      attribute: TestLong
    - name: TestDoublePrimitive
      attribute: TestDoublePrimitive
    - name: TestDouble
      attribute: TestDouble
    - name: TestFloatPrimitive
      attribute: TestFloatPrimitive
    - name: TestFloat
      attribute: TestFloat
    - name: TestShortPrimitive
      attribute: TestShortPrimitive
    - name: TestShort
      attribute: TestShort
    - name: TestCharPrimitive
      attribute: TestCharPrimitive
    - name: TestChar
      attribute: TestChar
    - name: TestBytePrimitive
      attribute: TestBytePrimitive
    - name: TestByte
      attribute: TestByte
    operation-jmx:
    - name: testOperationNoParams
      internal-name: testOperationNoParams
    - name: testOperation
      internal-name: testOperation
      params:
      - name: s
        type: String
        #default-value: "yaml default"
      - name: i
        type: Integer
        #default-value: "111"
      - name: b
        type: Boolean
        #default-value: "false"
      - name: l
        type: Long
        #default-value: "222"
      - name: d
        type: Double
        #default-value: "3.33"
      - name: f
        type: Float
        #default-value: "4.44"
      - name: h
        type: Short
        #default-value: "5"
      - name: c
        type: Character
        #default-value: "x"
      - name: y
        type: Byte
    - name: testOperationPrimitive
      internal-name: testOperationPrimitive
      params:
      - name: s
        type: string
        default-value: "yaml default"
      - name: i
        type: int
        default-value: "111"
      - name: b
        type: bool
        default-value: "false"
      - name: l
        type: long
        default-value: "222"
      - name: d
        type: double
        default-value: "3.33"
      - name: f
        type: float
        default-value: "4.44"
      - name: h
        type: short
        default-value: "5"
      - name: c
        type: char
        default-value: "x"
      - name: y
        type: byte

# MANAGED SERVERS

managed-servers:
  local-dmr:
    name: Local DMR UNUSED
    enabled: false
    resource-type-sets:
    - Standalone Environment
    - Deployment
    - Web Component
    - EJB
    - Datasource
    - XA Datasource
    - JDBC Driver
    - Transaction Manager
    - Messaging
    - Socket Binding Group
    - Clustering
    wait-for:
    - name: /
    metric-labels:
      feed-id: "%FeedId"

  local-jmx:
    name: Local JMX
    enabled: true
    resource-type-sets:
    - Main
    - Memory Pool
    - Hawkular
    - For Integration Test
    wait-for:
    - name: java.lang:type=Runtime
    metric-labels:
      feed-id: "%FeedId"

  remote-dmr:
  - name: Local DMR
    enabled: true
    host: 127.0.0.1
    port: 9990
    username: itest-admin
    password: itest-admin-password
    resource-type-sets:
    - Standalone Environment
    - Deployment
    - Web Component
    - EJB
    - Datasource
    - XA Datasource
    - JDBC Driver
    - Transaction Manager
    - Messaging
    - Socket Binding Group
    - Clustering
    wait-for:
    - name: /
    metric-labels:
      feed-id: "%FeedId"

  remote-jmx:
  - name: Remote JMX
    enabled: true
    url: http://127.0.0.1:8080/jolokia-war
    resource-type-sets:
    - Main
    - Memory Pool
    - For Integration Test
    wait-for:
    - name: java.lang:type=Runtime
    metric-labels:
      feed-id: "%FeedId"

platform:
  enabled:      true
  #machine-id:   my-machine-id-here
